---
title: "lab_04"
author: "derek willis"
date: "8/11/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Load libraries and establish settings

```{r}
# Turn off scientific notation
options(scipen=999)

library(tidyverse)
library(janitor)
library(lubridate)
```

## Getting Started

This week we'll be combining and joining data to make it more useful and to ask some questions about it. We'll use some of our 911 overdose call data to do this. The first thing we want to do is to combine multiple counties' data into a single dataframe so that we can ask some questions. First, let's combine data from Washington, Carroll and Allegany counties into a new dataframe.

*Before* you combine them you'll need to clean up some of the column names to make the data easier to work with - make sure you have loaded the library to do that. You also need to make sure that each column has the same name and datatype (you can check the datatypes using `glimpse`). If any of them does not, you need to fix that.

```{r}
carroll_911 <- read_csv("data/carroll_911.csv") %>% clean_names()
washington_911 <- read_csv("data/washington_911.csv")
allegany_911 <- read_csv("data/allegany_911.csv") %>% mutate(incident = as.character(incident))

combined_911 <- bind_rows(list(carroll_911, washington_911, allegany_911))
```

Then we'll join some demographic data with Baltimore City 911 calls and ask some questions of that. For that, you'll need to load the Baltimore City data and the demographic data, and join them based on the zip code. Remember, the zip codes in both dataframes must be the same datatype (and should be characters).

```{r}
baltimore_911 <- read_csv("data/baltimore_911.csv") %>% mutate(zip_code = as.character(zip_code))

maryland_zcta <- read_csv("data/maryland_zcta.csv") %>% clean_names() %>% mutate(zcta5n = as.character(zcta5n))

baltimore_911_with_demographics <- baltimore_911 %>% left_join(maryland_zcta, by=c('zip_code' = 'zcta5n'))
```

## Answer questions

Q1. Let's start with our data from Allegany, Anne Arundel and Carroll counties. Write code to generate a dataframe that shows the total number of calls for each county. What's the order of counties from most calls to least?

A1. Washington, Carroll, Allegany

```{r}
combined_911 %>% 
  group_by(county) %>% 
  summarise(calls = n()) %>% 
  arrange(desc(calls))
```

Q2. In your combined dataframe that you used in A1, add a column for the month of each call, then write code to show the total number of calls per county and month. Are there any outliers or noteworthy results? Describe the general pattern of the results.

A2. Washington had more calls in every month last year than either Allegany or Carroll have in any month. August saw the most calls for both Allegany and Carroll, while July had by far the most in Washington.

```{r}
combined_911 %>% 
  mutate(month = month(date)) %>% 
  group_by(county, month) %>% 
  summarize(calls = n()) %>% 
  arrange(desc(calls))
```

Q3. Let's turn to the Baltimore City data. Write code to find zip codes with the most calls, along with showing the percentage of black non-Hispanic population. Describe the top 10 zip codes in terms of their Black population. Where is that top zip code in the city in relation to downtown? Find the neighborhoods in that zip code that are listed in the data - you can use group_by or distinct to do this. What are some of those neighborhoods?

A3. The zip code with the most calls, 21217, is 86.4 percent Black, and is located northwest of the downtown area. 
Some of the neighborhoods in that zip code are Upton, Sandtown-Winchester and Mondawin.

```{r}
baltimore_911_with_demographics %>% 
  group_by(zip_code, pct_black_non_hispanic) %>% 
  summarize(calls = n()) %>% 
  arrange(desc(calls))

baltimore_911_with_demographics %>% 
  filter(zip_code == "21217") %>% 
  distinct(neighborhood) 

```




Q5. Choose your own adventure: I want you to come up with a question you could ask of the Baltimore City data that combines both the calls and the demographic information.

A5: 

```{r}

```
