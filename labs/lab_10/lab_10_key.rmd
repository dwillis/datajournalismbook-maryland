---
title: "lab_10"
author: "Derek Willis"
date: "2023-04-19"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## You will need

* the tidyverse, janitor and tigris libraries
* the tidycensus library for Q3

## Load libraries and establish settings

**Task** Create a codeblock and load appropriate packages and settings for this lab.

```{r}
# Turn off scientific notation
options(scipen=999)

# Load the tidyverse.
library(tidyverse)
library(janitor)
library(tigris)

```

Let's explore the election results from 2022, power outages and electric vehicle data and make some maps! 

## Questions 

**Q1.** Make a county-level map of Maryland's results for governor using `md_gov_county.csv` in the data folder, calculating the difference between Wes Moore's percentage of the total votes and Dan Cox's percentage of the total votes and displaying that percentage difference on the map. You can get the county geometry from the tigris library. What is the story here, and what is the county with the most interesting results?

**A1.**  

```{r}
md_gov <- read_csv("data/md_gov_county.csv") %>% 
  clean_names() %>% 
  mutate(geoid = as.character(geoid)) %>% 
  mutate(total = cox + moore + lashar + wallace + harding + write_ins) %>% 
  mutate(pct_moore = moore/total * 100, pct_cox = cox/total *100, moore_cox_diff = pct_moore - pct_cox)

counties <- counties()

md_counties <- counties %>%
  filter(STATEFP == "24")

md_gov_geometry <- md_counties %>% 
  inner_join(md_gov, by=c('GEOID'='geoid'))

ggplot() +
  geom_sf(data=md_gov_geometry, aes(fill=moore_cox_diff)) +
  theme_minimal() +
  scale_fill_viridis_b(option="magma")

```

**Q2.** Make a county-level map to explore the number of customers impacted by power outages in Maryland. Load the `county_outages_march2023.csv` file in the data folder and calculate a rate of customers with outages per 10,000 total customers for each county. Then join that dataframe to your Maryland counties dataframe you made in Q1 and create a county-level map of the results; you may need to tweak the fill scale to make the distinctions clearer. What's the potential story here? Given access to other months' outage data, what would your next steps be in reporting a story?

**A2.** Talbot customers did not have a good March, with a much higher rate of outages per 10,000 customers than any other county in Maryland. Frederick and Washington counties saw very little power interruption. Given other data, one path would be to create similar maps for other months to see if Talbot was an outlier in March or if there are consistent problems.

```{r}

md_county_outages <- read_csv("data/county_outages_march2023.csv") %>% mutate(rate = outage_customers/total_customers*10000)

md_county_outages_geo <- md_counties %>% inner_join(md_county_outages, by=c('NAME'='county'))

ggplot() +
  geom_sf(data=md_county_outages_geo, aes(fill=rate)) +
  theme_minimal() +
  scale_fill_viridis_b(option="magma",trans = "log")

```

**Q3.** You've been assigned a story about the use of electric vehicles in Maryland and you want to make a map of the percentage of 

**A3.**



**Q4.** Choose your own map adventure! In the data folder I've included county-level results for several other 2022 contests, including the Comptroller, Attorney General and the marijuana legalization amendment. I've also added the 2020 presidential results by county. Using one of the 2022 races that we haven't already used and at least one other contest for comparison, make a county-level map showing what you think is the most interesting aspect of that data, and describe the results in terms of a possible story. You can bring in other data, such as Census information, if you like.

**A4.**  

```{r}

```
